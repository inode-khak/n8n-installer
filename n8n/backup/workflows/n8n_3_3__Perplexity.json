{
  "name": "n8n-3-3: Perplexity",
  "nodes": [
    {
      "parameters": {
        "content": "## Create Article from Perplexity Research",
        "height": 465.2493344282225,
        "width": 625.851492623043,
        "color": 3
      },
      "id": "a4106938-68c9-43b7-bc4b-9c39b8151add",
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        0,
        600
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "## Convert Article into HTML",
        "height": 464.14912719677955,
        "width": 479.02028317328745,
        "color": 4
      },
      "id": "5b937528-3801-40ca-a43a-e2c9805401f1",
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        920,
        600
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "model": "gpt-4o-mini-2024-07-18",
        "options": {
          "responseFormat": "text"
        }
      },
      "id": "00d55ec6-ef21-439d-886d-72c9b2806df2",
      "name": "gpt-4o-mini",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "position": [
        1060,
        900
      ],
      "typeVersion": 1,
      "credentials": {
        "openAiApi": {
          "id": "qKk5wVYPDLRt63R9",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "options": {
          "frequencyPenalty": 0,
          "maxTokens": -1,
          "responseFormat": "text",
          "presencePenalty": 0,
          "temperature": 0,
          "timeout": 60000,
          "maxRetries": 2,
          "topP": 1
        }
      },
      "id": "b96d7e3e-a5d3-445f-8ccc-238ca73efbfa",
      "name": "gpt-4o-mini1",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "position": [
        1240,
        280
      ],
      "typeVersion": 1,
      "credentials": {
        "openAiApi": {
          "id": "qKk5wVYPDLRt63R9",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n \"type\": \"object\",\n \"properties\": {\n \"article\": {\n \"type\": \"object\",\n \"required\": [\"category\", \"title\", \"metadata\", \"content\", \"hashtags\"],\n \"properties\": {\n \"category\": {\n \"type\": \"string\",\n \"description\": \"Article category\"\n },\n \"title\": {\n \"type\": \"string\",\n \"description\": \"Article title\"\n },\n \"metadata\": {\n \"type\": \"object\",\n \"properties\": {\n \"timePosted\": {\n \"type\": \"string\",\n \"description\": \"Time since article was posted\"\n },\n \"author\": {\n \"type\": \"string\",\n \"description\": \"Article author name\"\n },\n \"tag\": {\n \"type\": \"string\",\n \"description\": \"Article primary tag\"\n }\n },\n \"required\": [\"timePosted\", \"author\", \"tag\"]\n },\n \"content\": {\n \"type\": \"object\",\n \"properties\": {\n \"mainText\": {\n \"type\": \"string\",\n \"description\": \"Main article content\"\n },\n \"sections\": {\n \"type\": \"array\",\n \"items\": {\n \"type\": \"object\",\n \"properties\": {\n \"title\": {\n \"type\": \"string\",\n \"description\": \"Section title\"\n },\n \"text\": {\n \"type\": \"string\",\n \"description\": \"Section content\"\n },\n \"quote\": {\n \"type\": \"string\",\n \"description\": \"Blockquote text\"\n }\n },\n \"required\": [\"title\", \"text\", \"quote\"]\n }\n }\n },\n \"required\": [\"mainText\", \"sections\"]\n },\n \"hashtags\": {\n \"type\": \"array\",\n \"items\": {\n \"type\": \"string\"\n },\n \"description\": \"Article hashtags\"\n }\n }\n }\n }\n}"
      },
      "id": "78aeb20b-c679-444f-b200-960b0758047d",
      "name": "Structured Output Parser1",
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "position": [
        320,
        900
      ],
      "typeVersion": 1.2
    },
    {
      "parameters": {
        "options": {
          "frequencyPenalty": 0,
          "maxTokens": -1,
          "responseFormat": "json_object",
          "presencePenalty": 0,
          "temperature": 0,
          "timeout": 60000,
          "maxRetries": 2,
          "topP": 1
        }
      },
      "id": "0568f2ca-838c-43c0-bd73-130aa86e3902",
      "name": "gpt-4o-mini2",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "position": [
        100,
        900
      ],
      "typeVersion": 1,
      "credentials": {
        "openAiApi": {
          "id": "qKk5wVYPDLRt63R9",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $json.telegram_chat_id }}",
        "text": "={{ $('Perplexity Topic Agent').item.json.output.slice(0, 300) }}",
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "HTML"
        }
      },
      "id": "e5521fc8-53fa-4cda-9adc-055fd6babe26",
      "name": "Telegram",
      "type": "n8n-nodes-base.telegram",
      "position": [
        2000,
        80
      ],
      "typeVersion": 1.2,
      "webhookId": "66a380b0-fc47-4922-a082-fe2aba045638",
      "credentials": {
        "telegramApi": {
          "id": "ANYJVKBZhKBjOxLX",
          "name": "perplexity_researchbot"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "options": {
          "frequencyPenalty": 0,
          "maxTokens": -1,
          "responseFormat": "text",
          "presencePenalty": 0,
          "temperature": 0,
          "timeout": 60000,
          "maxRetries": 2,
          "topP": 1
        }
      },
      "id": "3eda42fe-c377-49b8-8fc2-7dad94333a77",
      "name": "gpt-4o-mini5",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "position": [
        1940,
        900
      ],
      "typeVersion": 1,
      "credentials": {
        "openAiApi": {
          "id": "qKk5wVYPDLRt63R9",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Create a modern, responsive single-line HTML document. Convert any markdown to Tailwind CSS classes. Replace markdown lists with proper HTML list elements. Remove all newline characters while preserving </br> tags in content. Enhance the layout with Tailwind CSS cards where appropriate. Use the following base structure, but improve the styling and responsiveness:\n\n<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n <meta charset=\"UTF-8\">\n <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n <title>Comprehensive Overview of DeepSeek V3</title>\n <link href=\"https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css\" rel=\"stylesheet\">\n</head>\n\n<body class=\"bg-gray-100 font-sans\">\n <div class=\"relative p-4\">\n <div class=\"max-w-3xl mx-auto text-sm\">\n <div class=\"mt-3 bg-white rounded-lg shadow-lg flex flex-col justify-between leading-normal\">\n <div class=\"p-6\">\n <h1 class=\"text-gray-900 font-bold text-4xl mb-4\">Comprehensive Overview of DeepSeek V3</h1>\n <div class=\"mb-4\">\n <p class=\"leading-8\"><strong>Time Posted:</strong> Just now</p>\n <p class=\"leading-8\"><strong>Author:</strong> AI Research Team</p>\n <p class=\"leading-8\"><strong>Tag:</strong> AI Models</p>\n </div>\n <p class=\"leading-8 my-4\"><strong>DeepSeek V3</strong> is a state-of-the-art AI model that leverages\n advanced architectures and techniques to deliver high performance across various applications.\n This overview covers its key concepts, practical applications, advantages, limitations, and best\n practices for implementation.</p>\n <section class=\"mb-6\">\n <h2 class=\"text-2xl font-bold my-3\">Key Concepts and Core Components</h2>\n <p class=\"leading-8 my-3\"><strong>1. Mixture-of-Experts (MoE) Architecture:</strong> DeepSeek V3\n employs a Mixture-of-Experts (MoE) architecture, which consists of multiple neural networks,\n each optimized for different tasks. This architecture allows for efficient processing by\n activating only a portion of the network for each task, reducing hardware costs.</p>\n <p class=\"leading-8 my-3\"><strong>2. Parameters:</strong> The model boasts a total of 671\n billion\n parameters, with 37 billion active parameters for each token during processing. The addition\n of\n the Multi-Token Prediction (MTP) module increases the total parameters to 685 billion,\n making it\n significantly larger than other models like Meta's Llama 3.1 (405B).</p>\n <p class=\"leading-8 my-3\"><strong>3. Multi-head Latent Attention (MLA):</strong> DeepSeek V3\n uses\n Multi-head Latent Attention (MLA) to extract key details from text multiple times, improving\n its\n accuracy.</p>\n <p class=\"leading-8 my-3\"><strong>4. Multi-Token Prediction (MTP):</strong> The model utilizes\n Multi-Token Prediction to generate several tokens at once, speeding up inference and\n enabling\n speculative decoding.</p>\n <blockquote\n class=\"italic leading-8 my-3 p-5 text-indigo-600 font-semibold bg-indigo-50 rounded-lg border-l-4 border-indigo-600\">\n DeepSeek V3 employs a Mixture-of-Experts architecture for efficient processing.</blockquote>\n </section>\n <section class=\"mb-6\">\n <h2 class=\"text-2xl font-bold my-3\">Practical Applications</h2>\n <ol class=\"list-decimal pl-5\">\n <li class=\"leading-8 my-3\"><strong>Translation, Coding, and Content Generation:</strong>\n DeepSeek V3 is designed for a wide range of tasks including translation, coding, content\n generation, and reasoning. It excels in English, Chinese, coding, and mathematics,\n rivaling leading commercial models like OpenAI's GPT-4.</li>\n <li class=\"leading-8 my-3\"><strong>Research and Development:</strong> The open-source nature\n of DeepSeek V3 fuels innovation, allowing researchers to experiment with and build upon\n its technology.</li>\n <li class=\"leading-8 my-3\"><strong>Commercial Applications:</strong> The licensing of\n DeepSeek V3 makes it permissible for commercial use, opening it up to numerous\n applications across different industries.</li>\n <li class=\"leading-8 my-3\"><strong>Democratization of AI:</strong> By making powerful AI\n accessible, DeepSeek V3 levels the playing field, allowing smaller organizations to\n compete with larger ones.</li>\n </ol>\n <blockquote\n class=\"italic leading-8 my-3 p-5 text-indigo-600 font-semibold bg-indigo-50 rounded-lg border-l-4 border-indigo-600\">\n DeepSeek V3 democratizes AI access for smaller organizations.</blockquote>\n </section>\n <section class=\"mb-6\">\n <h2 class=\"text-2xl font-bold my-3\">Advantages</h2>\n <ol class=\"list-decimal pl-5\">\n <li class=\"leading-8 my-3\"><strong>Speed and Efficiency:</strong> DeepSeek V3 processes\n information at a blistering 60 tokens per second, a threefold increase over its\n predecessor. It uses advanced inference capabilities, deploying 32 H800 GPUs for prefill\n and 320 H800 GPUs for decoding.</li>\n <li class=\"leading-8 my-3\"><strong>Cost-Effectiveness:</strong> The model was trained for a\n mere $5.5 million, a fraction of the estimated over $100 million invested by OpenAI in\n GPT-4. DeepSeek V3 offers significantly lower prices for its online services, with 1\n million tokens priced at just $1.1, currently offered at a promotional rate of $0.28.\n </li>\n <li class=\"leading-8 my-3\"><strong>Innovation in Inference:</strong> The model's advanced\n inference capabilities set the standard for future model deployment, making it a\n powerful tool in the digital realm.</li>\n </ol>\n <blockquote\n class=\"italic leading-8 my-3 p-5 text-indigo-600 font-semibold bg-indigo-50 rounded-lg border-l-4 border-indigo-600\">\n DeepSeek V3 processes information at 60 tokens per second.</blockquote>\n </section>\n <section class=\"mb-6\">\n <h2 class=\"text-2xl font-bold my-3\">Limitations</h2>\n <ol class=\"list-decimal pl-5\">\n <li class=\"leading-8 my-3\"><strong>Deployment Complexity:</strong> Deploying DeepSeek V3\n requires advanced hardware and a deployment strategy that separates the prefilling and\n decoding stages, which might be unachievable for small companies due to a lack of\n resources. The recommended deployment unit for DeepSeek V3 is relatively large, posing a\n burden for small-sized teams.</li>\n <li class=\"leading-8 my-3\"><strong>Potential for Further Enhancement:</strong> Although\n DeepSeek V3 has achieved an end-to-end generation speed of more than two times that of\n DeepSeek V2, there still remains potential for further enhancement with the development\n of more advanced hardware.</li>\n </ol>\n <blockquote\n class=\"italic leading-8 my-3 p-5 text-indigo-600 font-semibold bg-indigo-50 rounded-lg border-l-4 border-indigo-600\">\n Deployment of DeepSeek V3 may be complex for small companies.</blockquote>\n </section>\n <section class=\"mb-6\">\n <h2 class=\"text-2xl font-bold my-3\">Best Practices for Implementation</h2>\n <ol class=\"list-decimal pl-5\">\n <li class=\"leading-8 my-3\"><strong>Hardware Requirements:</strong> Ensure that the\n deployment environment has the necessary advanced hardware to handle the model's\n requirements, including multiple GPUs for prefill and decoding.</li>\n <li class=\"leading-8 my-3\"><strong>Deployment Strategy:</strong> Implement a deployment\n strategy that separates the prefilling and decoding stages to optimize performance and\n efficiency.</li>\n <li class=\"leading-8 my-3\"><strong>Monitoring and Optimization:</strong> Continuously\n monitor the model's performance and optimize it as needed to address any limitations and\n improve efficiency.</li>\n <li class=\"leading-8 my-3\"><strong>Community Engagement:</strong> Engage with the\n open-source community to leverage the collective knowledge and resources available,\n which can help in addressing any challenges and improving the model further.</li>\n </ol>\n <blockquote\n class=\"italic leading-8 my-3 p-5 text-indigo-600 font-semibold bg-indigo-50 rounded-lg border-l-4 border-indigo-600\">\n Engage with the open-source community for better implementation.</blockquote>\n </section>\n <p class=\"leading-8 my-6\"><strong>Hashtags:</strong> <span\n class=\"text-indigo-600\">#DeepSeekV3</span> <span class=\"text-indigo-600\">#AI</span> <span\n class=\"text-indigo-600\">#MachineLearning</span> <span\n class=\"text-indigo-600\">#OpenSource</span></p>\n </div>\n </div>\n </div>\n </div>\n</body>\n\n</html>\n\n-------\n\nRequirements:\n- Output must be a single line of HTML\n- Enhanced with modern Tailwind CSS styling\n- Proper HTML list structures\n- Responsive design\n- No newlines except </br> in content\n- No markdown formatting\n- Clean, readable layout\n- Properly formatted hashtags\n- No explanation or additional text in output\n- No code block markers or escape characters\n- Wnsure Metadata, Title and Content are included in HTML\n\nMetadata: {{ $('Article').item.json.article.metadata.toJsonString() }}\nTitle: {{ $json.title }}\nContent: {{ $json.html }}\n"
      },
      "id": "27b0c8ee-40bd-4b22-8379-cf1d2c9e75ab",
      "name": "Basic LLM Chain",
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "position": [
        2000,
        720
      ],
      "typeVersion": 1.4
    },
    {
      "parameters": {},
      "id": "6e74bff0-c50e-49f2-81d3-30e42a7f653e",
      "name": "Do Nothing1",
      "type": "n8n-nodes-base.noOp",
      "position": [
        240,
        320
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "model": "gpt-4o",
        "options": {
          "frequencyPenalty": 0,
          "maxTokens": -1,
          "responseFormat": "text",
          "presencePenalty": 0,
          "temperature": 0,
          "timeout": 60000,
          "maxRetries": 2,
          "topP": 1
        }
      },
      "id": "4641cf5c-dc61-4bb3-9b01-42e1fae1cce5",
      "name": "gpt-4o-mini3",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "position": [
        560,
        340
      ],
      "typeVersion": 1,
      "credentials": {
        "openAiApi": {
          "id": "qKk5wVYPDLRt63R9",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "content": "## Create HTML Page with TailwindCSS Styling",
        "height": 465,
        "width": 791,
        "color": 6
      },
      "id": "40769626-277d-434c-800e-013f58aca061",
      "name": "Sticky Note4",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1880,
        600
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "## Parse Topic from Get Request",
        "height": 489.5271576259337,
        "width": 450.54438902818094
      },
      "id": "6716a09c-676e-4a60-85e1-5bd46c320e7b",
      "name": "Sticky Note2",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        0,
        0
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "## Improve the Users Topic",
        "height": 488,
        "width": 380,
        "color": 5
      },
      "id": "42e67497-0dce-4a1c-803d-e505274719ff",
      "name": "Sticky Note5",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        500,
        0
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "combinator": "and",
          "conditions": [
            {
              "id": "8e35de0a-ac16-4555-94f4-24e97bdf4b33",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              },
              "leftValue": "{{ $json.output }}",
              "rightValue": ""
            }
          ]
        },
        "options": {}
      },
      "id": "16b7966d-9e1f-44de-9e39-b5d1816d4738",
      "name": "If2",
      "type": "n8n-nodes-base.if",
      "position": [
        1800,
        380
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "efbe7563-8502-407e-bfa0-a4a26d8cddd4",
              "name": "user",
              "type": "string",
              "value": "={{ $('Execute Workflow Trigger').item.json.topic }}"
            },
            {
              "id": "05e0b629-bb9f-4010-96a8-10872764705a",
              "name": "system",
              "type": "string",
              "value": "Assistant is a large language model. Assistant is designed to be able to assist with a wide range of tasks, from answering simple questions to providing in-depth explanations and discussions on a wide range of topics. As a language model, Assistant is able to generate human-like text based on the input it receives, allowing it to engage in natural-sounding conversations and provide responses that are coherent and relevant to the topic at hand. Assistant is constantly learning and improving, and its capabilities are constantly evolving. It is able to process and understand large amounts of text, and can use this knowledge to provide accurate and informative responses to a wide range of questions. Additionally, Assistant is able to generate its own text based on the input it receives, allowing it to engage in discussions and provide explanations and descriptions on a wide range of topics. Overall, Assistant is a powerful system that can help with a wide range of tasks and provide valuable insights and information on a wide range of topics. Whether you need help with a specific question or just want to have a conversation about a particular topic, Assistant is here to assist. "
            }
          ]
        },
        "options": {}
      },
      "id": "f285fd52-fcec-47c8-bef4-9a41192bdd1b",
      "name": "Prompts",
      "type": "n8n-nodes-base.set",
      "position": [
        980,
        1320
      ],
      "typeVersion": 3.4
    },
    {
      "parameters": {},
      "id": "3c9f0345-c8d6-42cc-b13d-3bece505591d",
      "name": "Execute Workflow Trigger",
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "position": [
        100,
        1420
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "chatId": "={{ $('Execute Workflow Trigger').item.json.chatid }}",
        "text": "=<i>{{ $('Execute Workflow Trigger').item.json.topic }}</i>",
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "HTML"
        }
      },
      "id": "05b65866-26a3-4c0b-bb96-66ae9531af54",
      "name": "Telegram2",
      "type": "n8n-nodes-base.telegram",
      "position": [
        540,
        1420
      ],
      "typeVersion": 1.2,
      "webhookId": "e26cce1c-82dc-445d-a936-b09a5252a3ec",
      "credentials": {
        "telegramApi": {
          "id": "ANYJVKBZhKBjOxLX",
          "name": "perplexity_researchbot"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "combinator": "and",
          "conditions": [
            {
              "id": "7e2679dc-c898-415d-a693-c2c1e7259b6a",
              "operator": {
                "type": "string",
                "operation": "notContains"
              },
              "leftValue": "={{ $('Execute Workflow Trigger').item.json.topic }}",
              "rightValue": "undefined"
            }
          ]
        },
        "options": {}
      },
      "id": "2cab0988-7d8a-4d5f-b978-41beabb3006a",
      "name": "If",
      "type": "n8n-nodes-base.if",
      "position": [
        760,
        1420
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {},
      "id": "7d8857c4-24ef-4c53-b257-755552ce72bb",
      "name": "No Operation, do nothing",
      "type": "n8n-nodes-base.noOp",
      "position": [
        980,
        1540
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "## 🛠️perplexity_research_tool\n\n",
        "height": 623,
        "width": 1614,
        "color": 5
      },
      "id": "6595c537-ceff-43e4-a701-1b5ead37c5bc",
      "name": "Sticky Note6",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        0,
        1180
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Topic: {{ $json.text }}",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "Use the perplexity_research_tool to provide research on the users topic.\n\n",
          "maxIterations": 2
        }
      },
      "id": "98c65fe3-f35a-4fdd-8675-12298fed2b59",
      "name": "Perplexity Topic Agent",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "position": [
        1260,
        80
      ],
      "typeVersion": 1.6
    },
    {
      "parameters": {
        "name": "perplexity_research_tool",
        "description": "Call this tool to perform Perplexity research.",
        "workflowId": {
          "__rl": true,
          "value": "qIfZIa1iEUrvYVf3",
          "mode": "list",
          "cachedResultName": "n8n-3-3: Perplexity"
        },
        "fields": {
          "values": [
            {
              "name": "topic",
              "stringValue": "= {{ $json.text }}"
            },
            {
              "name": "chatid",
              "type": "numberValue",
              "numberValue": "=5147148553"
            }
          ]
        },
        "jsonSchemaExample": "{\n \"topic\": \"\"\n}"
      },
      "id": "31ef017a-5a85-4122-bd0e-eeec46580696",
      "name": "Call Perplexity Researcher",
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "position": [
        1460,
        280
      ],
      "typeVersion": 1.2
    },
    {
      "parameters": {},
      "id": "f88fdc12-a116-4dee-8840-a54e26d5795a",
      "name": "Do Nothing",
      "type": "n8n-nodes-base.noOp",
      "position": [
        2000,
        400
      ],
      "typeVersion": 1
    },
    {
      "parameters": {},
      "id": "6c7e6386-91b8-4c36-a034-ccf847288b50",
      "name": "Do Nothing2",
      "type": "n8n-nodes-base.noOp",
      "position": [
        700,
        940
      ],
      "typeVersion": 1
    },
    {
      "parameters": {},
      "id": "da9411ac-22dd-4206-ab6e-7588b557d10d",
      "name": "Do Nothing3",
      "type": "n8n-nodes-base.noOp",
      "position": [
        1680,
        860
      ],
      "typeVersion": 1
    },
    {
      "parameters": {},
      "id": "de3083ad-75e7-464f-a2e6-2f46860712c7",
      "name": "Do Nothing4",
      "type": "n8n-nodes-base.noOp",
      "position": [
        940,
        320
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "## 🤖Perform Perplexity Research",
        "height": 488,
        "width": 480,
        "color": 3
      },
      "id": "e402411e-a6d1-481f-be03-1fab38d76400",
      "name": "Sticky Note7",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1140,
        0
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "57f0eab2-ef1b-408c-82d5-a8c54c4084a6",
              "name": "topic",
              "type": "string",
              "value": "={{ $json.message.text }}"
            }
          ]
        },
        "options": {}
      },
      "id": "f1d9320e-43a6-4ffe-b542-8e908ed43fcd",
      "name": "Get Topic",
      "type": "n8n-nodes-base.set",
      "position": [
        60,
        100
      ],
      "typeVersion": 3.4
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "combinator": "and",
          "conditions": [
            {
              "id": "2c565aa5-0d11-47fb-8621-6db592579fa8",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              },
              "leftValue": "={{ $json.topic }}",
              "rightValue": ""
            }
          ]
        },
        "options": {}
      },
      "id": "43807721-ba13-476d-9851-a7ca73d63e46",
      "name": "If Topic Exists",
      "type": "n8n-nodes-base.if",
      "position": [
        240,
        100
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=How would you improve the following prompt as of {{ $now }}, focusing on:\n\n1. Key Concepts & Definitions\n - Main terminology and foundational concepts\n - Technical background and context\n\n2. Core Components\n - Essential elements and their relationships\n - Critical processes and workflows\n\n3. Practical Applications\n - Real-world use cases\n - Implementation considerations\n\n4. Analysis & Insights\n - Advantages and limitations\n - Best practices and recommendations\n\nThe final output should be a maximum 2 sentence pure text prompt without any preamble or further explanation. The final output will be providced to Perplexity as a research prompt.\n\nMake sure to use single quotes to mark user's query and maintain JSON compatibility\n\nPrompt to analyze: {{ $json.topic }}"
      },
      "id": "365d51f5-6005-4a92-b68e-491a37e626f3",
      "name": "Improve Users Topic",
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "position": [
        560,
        100
      ],
      "typeVersion": 1.4
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "combinator": "and",
          "conditions": [
            {
              "id": "329653d4-330f-4b41-96e7-4652c1448902",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              },
              "leftValue": "={{ $json.text }}",
              "rightValue": ""
            }
          ]
        },
        "options": {}
      },
      "id": "f051bc1d-ff2b-4537-a097-f25d27801a1a",
      "name": "If Topic",
      "type": "n8n-nodes-base.if",
      "position": [
        940,
        100
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "0aa8fcc9-26f4-485c-8fc1-a5c13d0dd279",
              "name": "telegram_chat_id",
              "type": "number",
              "value": "={{ $('Telegram Trigger').item.json.message.chat.id }}"
            }
          ]
        },
        "options": {}
      },
      "id": "012af830-6a99-464b-907f-c482a4eb737e",
      "name": "Chat Id",
      "type": "n8n-nodes-base.set",
      "position": [
        1800,
        80
      ],
      "typeVersion": 3.4,
      "disabled": true
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "0eb5952b-c133-4b63-8102-d4b8ec7b9b5a",
              "name": "article",
              "type": "object",
              "value": "={{ $json.output.article }}"
            }
          ]
        },
        "options": {}
      },
      "id": "28de0135-c651-43c4-9837-9e3502fa156b",
      "name": "Article",
      "type": "n8n-nodes-base.set",
      "position": [
        460,
        720
      ],
      "typeVersion": 3.4
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Extract a JSON object from this content: {{ $json.output }}",
        "hasOutputParser": true,
        "options": {}
      },
      "id": "9a8d0dd5-9e49-4327-aa47-83243aabff5d",
      "name": "Extract JSON",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "position": [
        120,
        720
      ],
      "retryOnFail": true,
      "typeVersion": 1.6
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "combinator": "and",
          "conditions": [
            {
              "id": "329653d4-330f-4b41-96e7-4652c1448902",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              },
              "leftValue": "{{ $json.article }}",
              "rightValue": ""
            }
          ]
        },
        "options": {}
      },
      "id": "42876285-2d1c-4899-9369-5c9565918156",
      "name": "If Article",
      "type": "n8n-nodes-base.if",
      "position": [
        700,
        720
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "agent": "conversationalAgent",
        "promptType": "define",
        "text": "=Convert this verbatim into HTML: {{ $json.article.toJsonString() }}\n\n## Formatting Guidelines\n- HTML document must be single line document without tabs or line breaks\n- Use proper HTML tags throughout\n- Do not use these tags: <html> <body> <style> <head>\n- Use <h1> tag for main title\n- Use <h2> tags for secondary titles\n- Structure with <p> tags for paragraphs\n- Include appropriate spacing\n- Use <blockquote> for direct quotes\n- Maintain consistent formatting\n- Write in clear, professional tone\n- Break up long paragraphs\n- Use engaging subheadings\n- Include transitional phrases\n\nThe final JSON response should contain only the title and content fields, with the content including all HTML formatting.\n{\n\t\"title\": \"the title\",\n\t\"content\": \"the HTML\"\n}",
        "options": {}
      },
      "id": "5a193b37-8922-4786-a092-f925af3e2963",
      "name": "Create HTML Article",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "position": [
        1040,
        720
      ],
      "retryOnFail": true,
      "typeVersion": 1.6
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "combinator": "and",
          "conditions": [
            {
              "id": "329653d4-330f-4b41-96e7-4652c1448902",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              },
              "leftValue": "={{ $json.output.parseJson().title }}",
              "rightValue": ""
            },
            {
              "id": "0a05f73a-2901-4157-8194-cb81d259ce71",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              },
              "leftValue": "={{ $json.output.parseJson().content }}",
              "rightValue": ""
            },
            {
              "id": "b61c1d25-a010-42d3-9f9d-fa927c483bae",
              "operator": {
                "name": "filter.operator.equals",
                "type": "string",
                "operation": "equals"
              },
              "leftValue": "",
              "rightValue": ""
            }
          ]
        },
        "options": {}
      },
      "id": "bef63ee8-c747-47d1-a001-190ed5b7490a",
      "name": "If HTML",
      "type": "n8n-nodes-base.if",
      "position": [
        1460,
        720
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "af335333-acb8-4c9e-8184-d20cd03e08f6",
              "name": "title",
              "type": "string",
              "value": "={{ $json.output.parseJson().title }}"
            },
            {
              "id": "7fbd2264-c0e1-4bdc-b754-b0faa538879c",
              "name": "content",
              "type": "string",
              "value": "={{ $json.output.parseJson().content }}"
            }
          ]
        },
        "options": {}
      },
      "id": "bb994b0d-ac58-46f2-89cf-6c874ace47ac",
      "name": "Contents",
      "type": "n8n-nodes-base.set",
      "position": [
        1680,
        640
      ],
      "typeVersion": 3.4
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "0aa8fcc9-26f4-485c-8fc1-a5c13d0dd279",
              "name": "telegram_chat_id",
              "type": "number",
              "value": 1234567890
            }
          ]
        },
        "options": {}
      },
      "id": "5645ebb6-9cac-46c7-a494-2b6eeab5e2c0",
      "name": "Chat Id1",
      "type": "n8n-nodes-base.set",
      "position": [
        340,
        1420
      ],
      "typeVersion": 3.4
    },
    {
      "parameters": {
        "content": "## Optional",
        "height": 340,
        "width": 420
      },
      "id": "82509660-f6ab-4d06-9bdb-7c37d07b1afb",
      "name": "Sticky Note3",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        280,
        1320
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "## Optional",
        "height": 340,
        "width": 420
      },
      "id": "bd44870b-d3b0-4243-867c-9e89b755203c",
      "name": "Sticky Note8",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1740,
        0
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "eb89464a-5919-4962-880c-3f5903e267de",
              "name": "response",
              "type": "string",
              "value": "={{ $('Perplexity').item.json.choices[0].message.content }}"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "id": "9f5eda47-f390-4519-80c5-e86d7a167022",
      "name": "Success Response",
      "type": "n8n-nodes-base.set",
      "position": [
        1380,
        1320
      ],
      "typeVersion": 3.4
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "eb89464a-5919-4962-880c-3f5903e267de",
              "name": "response",
              "type": "string",
              "value": "=Error. No topic provided."
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "id": "ffdde999-6975-48c0-9a1e-147bd3ba032a",
      "name": "Error Response",
      "type": "n8n-nodes-base.set",
      "position": [
        1380,
        1540
      ],
      "typeVersion": 3.4
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.perplexity.ai/chat/completions",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n \"model\": \"sonar\",\n \"messages\": [\n {\n \"role\": \"system\",\n \"content\": \"{{ $json.system }}\"\n },\n {\n \"role\": \"user\",\n \"content\": \"{{ $json.user }}\"\n }\n ],\n \"max_tokens\": \"4000\",\n \"temperature\": 0.2,\n \"top_p\": 0.9,\n \"return_citations\": true,\n \"search_domain_filter\": [\n \"perplexity.ai\"\n ],\n \"return_images\": false,\n \"return_related_questions\": false,\n \"search_recency_filter\": \"month\",\n \"top_k\": 0,\n \"stream\": false,\n \"presence_penalty\": 0,\n \"frequency_penalty\": 1\n}",
        "options": {}
      },
      "id": "978a9dc0-c24a-4f65-9003-a19107f8b07c",
      "name": "Perplexity",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        1180,
        1320
      ],
      "typeVersion": 4.2,
      "credentials": {
        "httpHeaderAuth": {
          "id": "rfHHMULmrcEWfXNu",
          "name": "Perplexity"
        }
      }
    },
    {
      "parameters": {
        "updates": [
          "message"
        ],
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.2,
      "position": [
        -180,
        100
      ],
      "id": "5ceca3d9-d571-4217-87e4-741b266652b4",
      "name": "Telegram Trigger",
      "webhookId": "87e7c639-6b21-40ff-a651-7466bcab306b",
      "credentials": {
        "telegramApi": {
          "id": "ANYJVKBZhKBjOxLX",
          "name": "perplexity_researchbot"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "={{ $json.escapedText }}",
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "MarkdownV2"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2740,
        720
      ],
      "id": "e97ac450-9e81-4f19-a3c9-2e96a33084b4",
      "name": "Telegram1",
      "webhookId": "ea8b3f0e-8b49-47c5-9260-839ec40714b8",
      "credentials": {
        "telegramApi": {
          "id": "ANYJVKBZhKBjOxLX",
          "name": "perplexity_researchbot"
        }
      }
    },
    {
      "parameters": {
        "html": "={{ $json.text }}",
        "options": {}
      },
      "type": "n8n-nodes-base.markdown",
      "typeVersion": 1,
      "position": [
        2340,
        720
      ],
      "id": "d20d5795-f7c6-474d-927f-b05b24e824d5",
      "name": "Markdown"
    },
    {
      "parameters": {
        "jsCode": "// Получаем преобразованный HTML в формат Markdown\nconst markdownText = items[0].json.data; // Используйте ваше собственное имя поля\n\n// Список специальных символов, которые нужно экранировать в MarkdownV2\nconst escapeMarkdownV2 = (text) => {\n  // Экранируем специальные символы MarkdownV2\n  // Порядок важен! Сначала экранируем сам символ экранирования\n  return text\n    .replace(/\\\\/g, '\\\\\\\\') // Экранирование самого обратного слеша\n    .replace(/\\_/g, '\\\\_')\n    .replace(/\\*/g, '\\\\*')\n    .replace(/\\[/g, '\\\\[')\n    .replace(/\\]/g, '\\\\]')\n    .replace(/\\(/g, '\\\\(')\n    .replace(/\\)/g, '\\\\)')\n    .replace(/\\~/g, '\\\\~')\n    .replace(/\\`/g, '\\\\`')\n    .replace(/\\>/g, '\\\\>')\n    .replace(/\\#/g, '\\\\#')\n    .replace(/\\+/g, '\\\\+')\n    .replace(/\\-/g, '\\\\-')\n    .replace(/\\=/g, '\\\\=')\n    .replace(/\\|/g, '\\\\|')\n    .replace(/\\{/g, '\\\\{')\n    .replace(/\\}/g, '\\\\}')\n    .replace(/\\./g, '\\\\.')\n    .replace(/\\!/g, '\\\\!');\n};\n\n// Экранируем текст\nconst escapedText = escapeMarkdownV2(markdownText);\n\n// Возвращаем результат\nreturn {\n  json: {\n    escapedText: escapedText\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2520,
        720
      ],
      "id": "6d2e5276-4b17-4df7-8734-26835e68fdfd",
      "name": "Code"
    }
  ],
  "pinData": {},
  "connections": {
    "gpt-4o-mini": {
      "ai_languageModel": [
        [
          {
            "node": "Create HTML Article",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "gpt-4o-mini1": {
      "ai_languageModel": [
        [
          {
            "node": "Perplexity Topic Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser1": {
      "ai_outputParser": [
        [
          {
            "node": "Extract JSON",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "gpt-4o-mini2": {
      "ai_languageModel": [
        [
          {
            "node": "Extract JSON",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "gpt-4o-mini5": {
      "ai_languageModel": [
        [
          {
            "node": "Basic LLM Chain",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Basic LLM Chain": {
      "main": [
        [
          {
            "node": "Markdown",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "gpt-4o-mini3": {
      "ai_languageModel": [
        [
          {
            "node": "Improve Users Topic",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "If2": {
      "main": [
        [
          {
            "node": "Extract JSON",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Do Nothing",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prompts": {
      "main": [
        [
          {
            "node": "Perplexity",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Execute Workflow Trigger": {
      "main": [
        [
          {
            "node": "Chat Id1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Telegram2": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Prompts",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "No Operation, do nothing": {
      "main": [
        [
          {
            "node": "Error Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Perplexity Topic Agent": {
      "main": [
        [
          {
            "node": "If2",
            "type": "main",
            "index": 0
          },
          {
            "node": "Chat Id",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Call Perplexity Researcher": {
      "ai_tool": [
        [
          {
            "node": "Perplexity Topic Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Get Topic": {
      "main": [
        [
          {
            "node": "If Topic Exists",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Topic Exists": {
      "main": [
        [
          {
            "node": "Improve Users Topic",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Do Nothing1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Improve Users Topic": {
      "main": [
        [
          {
            "node": "If Topic",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Topic": {
      "main": [
        [
          {
            "node": "Perplexity Topic Agent",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Do Nothing4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Chat Id": {
      "main": [
        [
          {
            "node": "Telegram",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Article": {
      "main": [
        [
          {
            "node": "If Article",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract JSON": {
      "main": [
        [
          {
            "node": "Article",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Article": {
      "main": [
        [
          {
            "node": "Create HTML Article",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Do Nothing2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create HTML Article": {
      "main": [
        [
          {
            "node": "If HTML",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If HTML": {
      "main": [
        [
          {
            "node": "Contents",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Do Nothing3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Contents": {
      "main": [
        [
          {
            "node": "Basic LLM Chain",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Chat Id1": {
      "main": [
        [
          {
            "node": "Telegram2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Perplexity": {
      "main": [
        [
          {
            "node": "Success Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Telegram Trigger": {
      "main": [
        [
          {
            "node": "Get Topic",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Markdown": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Telegram1": {
      "main": [
        []
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "Telegram1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "2d4526d7e2b7123bfb0e1996caa47744a7651d73096bbc7220a5e9657d119dfc"
  },
  "tags": [],
  "id": "pj9r4xFLw7UU770E"
}